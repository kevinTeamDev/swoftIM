1. 启动ws(可配置同时启动http)
```
$ php bin/swoft ws:start

# 热更新
$ php swoftcli.phar run -c ws:start
```

2. 使用Chrome插件Smart Websocket Client 进行模拟链接（或者 http://www.websocket.org/echo.html）
2.1 链接地址为 `ws://192.168.10.10:18308/chat`
2.2 发送数据包为 
```json
{"cmd": "home.echo","data": "message data","ext": {"ip": "xx", "os": "mac"}}
```
2.3 响应数据
```json
(home.echo) Recv: {
  "cmd": "home.echo",
  "data": "message data",
  "ext": {
    "ip": "xx",
    "os": "mac"
  }
}
```
2.4 对应控制器为 `app/WebSocket/Chat/HomeController.php`


3. 生成迁移文件
```bash
php bin/swoft migrate:create add_msg_table
```
3.1 运行迁移
```bash
php bin/swoft migrate:up
```
3.2 生成实体
```bash
php bin/swoft entity:gen
```


### 多对一聊天涉及逻辑
1. 用户A通过PHP进入页面，进入之前用php生成token，并赋值到页面上。前后端分离的话，改为api调用
2. 前端页面调用ws 建立链接的时候，传入uid，token参数，用于后端验证。验证通过建立连接
3. 此时fd唯一，可以识别用户
4. 若admin在线，则直接推送到admin对应窗口
5. 若admin不在线。则等待admin上线之后，按需（按频道推送）
6. 进入窗口时，加载之前的聊天记录


1. token不能被伪造
2. 同一token，打开多个页面，以最前面的页面优先。后者无法登录



用户首先进入channel，创建或者找到频道，然后跳转进入频道
使用admin，进入不同的频道，接收对应的消息，包括历史记录和未收到消息条数
